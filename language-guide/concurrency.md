# Concurrency

最終更新日:

Swift には、構造化された方法で非同期および並列コードを書くためのサポートが組み込まれています。非同期コード(*asynchronous code*)は、一度にプログラムの 1 箇所のみが実行されますが、後で中断および再開できます。プログラム内のコードを一時中断して後に再開することで、ネットワーク上のデータの取得やファイルの解析などの長く時間のかかる操作の途中で、UI の更新などの短期的な操作を行い、その後引き続き操作を続けることができます。並列コード(*parallel code*)とは、複数のコードを同時に実行することを意味します。 例えば、4 コアプロセッサを搭載したコンピュータは、各コアがタスクの 1 つを実行しながら、4 つのコードを同時に実行できます。並列および非同期コードを使用するプログラムは、一度に複数の操作を実行します。外部システムを待っている操作を一時停止し、メモリセーフな方法でこのコードを簡単に記述できます。

並列または非同期コードを使って様々なタスクを追加でスケジューリングできる柔軟性は、逆に複雑さが増すコストも伴います。Swift を使用すると、コンパイルラチェックで意図を表現できます。例えば、アクター(*actor*)を使用して可変状態に安全にアクセスできます。ただし、低速なものやバグを含んだコードに同時並行処理を追加しても、高速になったり正確になることは保証されません。実際、同時並行処理を追加すると、コードのデバッグが難しくなる可能性さえあります。ただし、Swift の言語レベルのサポートを使用して、同時並列実行する必要があるコードの同時並列実行時に Swift が問題をキャッチするのに役立ちます。

この章の残りの部分では、非同期コードと並列コードのこの一般的な組み合わせを参照するために *Concurrency* という用語を使用します。

> NOTE  
> 以前に同時並行コードを書いたことがある場合は、スレッドの操作に慣れている可能性があります。Swiftの Concurrency モデルはスレッドの上に構築されていますが、直接スレッドと対話することはありません。Swift の非同期関数は、実行中のスレッドを放棄することができ、最初の関数がブロックされている間、そのスレッド上で別の非同期関数を実行できます。

Swift の言語サポートを使用せずに同時並行処理を書くことは可能ですが、そのコードは読みにくい傾向があります。例えば、次のコードは写真名のリストをダウンロードし、そのリストの最初の写真をダウンロードし、その写真をユーザーに表示します。

```swift
listPhotos(inGallery: "Summer Vacation") { photoNames in
    let sortedNames = photoNames.sorted()
    let name = sortedNames[1]
    downloadPhoto(named: name) { photo in
        show(photo)
    }
}
```

このような単純なケースでも、コードには一連の完了ハンドラを記述する必要があるため、ネストされたクロージャを書くことになります。このスタイルでは、深いネストを持つより複雑なコードはすぐに扱いにくくなる可能性があります。

## Defining and Calling Asynchronous Functions(非同期関数の定義と呼び出し)

## Asynchronous Sequences(非同期シーケンス)

## Calling Asynchronous Functions in Parallel(非同期関数を並列に呼び出す)

## Tasks and Task Groups(タスクとタスクグループ)

### Unstructured Concurrency(非構造化同時並行処理)

### Task Cancellation(タスクのキャンセル)

## Actors(アクター)
